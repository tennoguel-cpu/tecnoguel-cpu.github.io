<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TecnoGuel IA Chat - Asesor Android/Samsung | V4.0 CONOCIMIENTO EXPANDIDO</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos espec√≠ficos para el chat (no incluidos en style.css) */
        .chat-container {
            width: 90%;
            max-width: 800px;
            margin: 40px auto;
            background: rgba(1, 23, 40, 0.8); /* Fondo semi-transparente oscuro */
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6); /* Ne√≥n Cian */
            border: 1px solid var(--color-neon-cian);
        }

        #chat-window {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            border-bottom: 1px solid var(--color-neon-magenta);
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px 15px 0 0;
        }

        .message-row {
            display: flex;
            margin-bottom: 15px;
        }

        .message-user {
            justify-content: flex-end;
        }

        .message-ia {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 20px;
            line-height: 1.4;
            position: relative;
        }

        .message-user .message-bubble {
            background-color: var(--color-neon-magenta);
            color: #fff;
            border-bottom-right-radius: 5px;
            box-shadow: 0 0 8px rgba(255, 0, 204, 0.5);
        }

        .message-ia .message-bubble {
            background-color: var(--color-fondo-terciario);
            color: var(--color-texto-base);
            border: 1px solid var(--color-neon-cian);
            border-bottom-left-radius: 5px;
            box-shadow: 0 0 8px rgba(0, 255, 204, 0.5);
            /* Animaci√≥n de escritura */
            animation: typing 0.5s steps(20, end);
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        /* Indicador de riesgo */
        .risk-indicator {
            font-size: 0.8em;
            margin-top: 5px;
            padding: 5px 10px;
            border-radius: 10px;
            font-weight: bold;
            display: inline-block;
        }
        
        /* Definici√≥n de colores de riesgo usando variables de style.css */
        .risk-indicator-critico {
            background-color: #ff0000; /* Rojo Puro Cr√≠tico */
            color: #fff;
            box-shadow: 0 0 15px #ff0000;
        }
        .risk-indicator-alto {
            background-color: #ff3300; 
            color: #fff;
            box-shadow: 0 0 5px #ff3300;
        }
        .risk-indicator-medio {
            background-color: #ff9900; 
            color: #000;
        }
        .risk-indicator-bajo {
            background-color: var(--color-neon-cian); 
            color: #000;
        }
        
        #input-area {
            display: flex;
            padding: 20px;
            gap: 10px;
        }

        #user-input {
            flex-grow: 1;
            padding: 15px;
            border: 2px solid var(--color-neon-magenta);
            border-radius: 25px;
            background: var(--color-fondo-terciario);
            color: var(--color-texto-base);
            font-size: 1em;
            transition: border-color 0.3s;
        }

        #user-input:focus {
            outline: none;
            border-color: var(--color-neon-cian);
            box-shadow: 0 0 10px var(--color-neon-cian);
        }

        #send-button {
            /* Usa los estilos de bot√≥n del CSS maestro */
            padding: 15px 25px;
            border-radius: 25px;
        }
        
        /* Bot√≥n de volver a inicio */
        #volver {
            margin-top: 20px;
            margin-bottom: 50px;
        }
    </style>
</head>
<body>

    <header>
        <h1>Asesor Virtual IA V4.0</h1>
        <p>Modelo T√©cnico Avanzado para Android y Samsung</p>
    </header>

    <div class="chat-container">
        <div id="chat-window">
            </div>
        <div id="input-area">
            <input type="text" id="user-input" placeholder="Escribe tu consulta aqu√≠..." onkeypress="handleKeyPress(event)">
            <button id="send-button" onclick="sendMessage()">Enviar Consulta</button>
        </div>
    </div>
    
    <section id="volver">
        <button onclick="window.location.href='index.html'">Volver a Inicio</button>
    </section>
    
    <script>
    
    // ------------------------------------------------------------------
    // 1. BASE DE CONOCIMIENTO M√ÅXIMA (ia_knowledge_base.js - CONSOLIDADA)
    // ------------------------------------------------------------------
    
    const iaKnowledge = {
        // --- G00: RESPUESTA POR DEFECTO Y SALUDOS ---
        DEFAULT: {
            ia: "El sistema no encuentra una soluci√≥n directa en la base de datos local para esa consulta. Realizar√© una b√∫squeda avanzada en la web. Por favor, s√© m√°s espec√≠fico o visita la secci√≥n 'Informaci√≥n Adicional'.",
            keywords: ['default', 'error', 'no se'],
            riesgo: null
        },
        SALUDO: {
            ia: ["¬°Saludos! Soy el Asesor IA V4.0 de TecnoGuel, listo para asistirte con cualquier consulta t√©cnica. ¬øEn qu√© puedo ayudarte hoy?", "Hola. Acceso concedido al Asesor IA. Ingresa tu consulta sobre Android o Samsung. Mi base de datos ha sido ampliada."],
            keywords: ['hola', 'saludos', 'buenos dias', 'que tal', 'asesor', 'ia'],
            riesgo: null
        },
        GRACIAS: {
            ia: ["Es un placer servirte. Si tienes m√°s consultas, no dudes en preguntar.", "Agradezco tu mensaje. Estoy aqu√≠ si me necesitas. ¬°Fin de la consulta!"],
            keywords: ['gracias', 'agradezco', 'te lo agradezco', 'de nada'],
            riesgo: null
        },
    
        // --- MANTENIMIENTO Y RENDIMIENTO (100-199) ---
        RENDIMIENTO_LENTO: {
            ia: "Un rendimiento lento se debe a la acumulaci√≥n de cach√© o demasiadas apps en segundo plano. Te recomendamos nuestro servicio de 'Limpieza de software' (C$50) para optimizaci√≥n profunda.",
            keywords: ['lento', 'se traba', 'bajo rendimiento', 'optimizar', 'rapidez', 'lag', 'ralentizacion'],
            riesgo: null
        },
        BORRAR_CACHE: {
            ia: "Para borrar la cach√© de una app, ve a Ajustes > Aplicaciones, selecciona la app, luego 'Almacenamiento' y pulsa 'Borrar cach√©'. **No borres los Datos** sin respaldo.",
            keywords: ['cache', 'limpiar', 'borrar datos', 'eliminar cache'],
            riesgo: 'Bajo. Borrar datos de apps puede eliminar configuraciones personales y progreso en juegos.'
        },
        BATERIA_DRENAJE: {
            ia: "Si la bater√≠a se drena r√°pido, ve a Ajustes > Bater√≠a y comprueba qu√© apps consumen m√°s. Deshabilita la 'Sincronizaci√≥n autom√°tica' o revisa si la pantalla est√° muy brillante.",
            keywords: ['bateria', 'drenaje', 'calienta', 'caliente', 'calentamiento', 'vida bateria'],
            riesgo: null
        },
        REINICIO_FABRICA: {
            ia: "El restablecimiento de f√°brica elimina **TODOS** los datos. Aseg√∫rate de hacer una copia de seguridad (fotos, contactos, documentos) antes. El procedimiento est√° en Ajustes > Administraci√≥n general > Restablecer.",
            keywords: ['formatear', 'reinicio fabrica', 'resetear', 'borrar todo', 'hard reset'],
            riesgo: 'ALTO. P√©rdida total de datos si no hay copia de seguridad. ¬°Proceder con cautela!'
        },
        AHORRO_ENERGIA_EXTREMO: {
            ia: "El modo de Ahorro de Energ√≠a Extremo limita el rendimiento del CPU, el uso de datos en segundo plano y reduce las animaciones. Act√≠valo solo cuando necesites extender la vida de la bater√≠a al m√°ximo.",
            keywords: ['ahorro energia', 'modo extremo', 'super ahorro', 'maximo ahorro'],
            riesgo: null
        },
        MEMORIA_RAM_LIBRE: {
            ia: "Para liberar RAM, puedes usar la funci√≥n 'Cuidado de la bater√≠a y dispositivo' y optimizar la memoria. Si el tel√©fono lo permite, activa la funci√≥n 'RAM Plus' o 'Virtual RAM' para usar almacenamiento como RAM extra.",
            keywords: ['memoria ram', 'ram plus', 'liberar ram', 'virtual ram', 'optimizar memoria'],
            riesgo: null
        },
    
        // --- SAMSUNG ONE UI / DEX (200-299) ---
        GOOD_LOCK: {
            ia: "Good Lock es la suite de personalizaci√≥n avanzada de Samsung. Se descarga desde la Galaxy Store y permite modificar la interfaz de usuario (UI) con m√≥dulos para la pantalla de bloqueo, notificaciones y m√°s.",
            keywords: ['good lock', 'one ui', 'personalizacion samsung', 'galaxy store'],
            riesgo: null
        },
        SAMSUNG_DEX: {
            ia: "Samsung DeX permite usar tu tel√©fono como una PC, proyectando una interfaz de escritorio en un monitor. Si falla, verifica que el cable o adaptador sea compatible con DeX o que el tel√©fono tenga suficiente carga.",
            keywords: ['dex', 'samsung dex', 'proyectar', 'escritorio', 'deX fallo'],
            riesgo: null
        },
        SECURE_FOLDER: {
            ia: "La Carpeta Segura (Secure Folder) de Samsung crea un espacio encriptado y aislado para apps, fotos y documentos privados, separ√°ndolos completamente de tu espacio principal. Es muy segura y se activa en Ajustes > Datos Biom√©tricos y seguridad.",
            keywords: ['carpeta segura', 'secure folder', 'privacidad samsung', 'ocultar apps'],
            riesgo: null
        },
        BIXBY_RUTINAS: {
            ia: "Las Rutinas de Bixby te permiten automatizar tareas: por ejemplo, 'Si llego a casa y es de noche, poner sonido en silencio y activar Wi-Fi'. Es una excelente herramienta de optimizaci√≥n de Samsung.",
            keywords: ['bixby', 'rutinas bixby', 'automatizar', 'routines'],
            riesgo: null
        },
        ONE_HAND_MODE: {
            ia: "El Modo de una mano (One Hand Mode) en Samsung se activa haciendo un gesto de deslizamiento r√°pido hacia abajo desde la parte central inferior de la pantalla. √ötil para usar tel√©fonos grandes con una sola mano.",
            keywords: ['una mano', 'one hand mode', 'uso facil', 'modo peque√±o'],
            riesgo: null
        },
    
        // --- ANDROID GENERAL / SISTEMA OPERATIVO (300-399) ---
        ROOT_RIESGO: {
            ia: "El 'Root' anula la garant√≠a y es un proceso de ALTO RIESGO. Recomendamos nuestro servicio t√©cnico profesional. Si lo haces por tu cuenta, podr√≠as da√±ar el sistema (brick).",
            keywords: ['root', 'acceso root', 'magisk', 'superusuario', 'superuser'],
            riesgo: 'CR√çTICO. Anulaci√≥n de garant√≠a y riesgo de da√±ar permanentemente el dispositivo.'
        },
        BOOTLOADER_DESBLOQUEO: {
            ia: "El desbloqueo del **Bootloader** es CR√çTICO, ya que borra TODOS los datos y activa un flag de seguridad (Knox en Samsung) que puede deshabilitar ciertas funciones. **Solo para t√©cnicos expertos.**",
            keywords: ['bootloader', 'desbloquear', 'fastboot', 'knox', 'oem unlock'],
            riesgo: 'CR√çTICO. P√©rdida de datos total y posible anulaci√≥n de hardware (Knox).'
        },
        ADB_COMANDOS: {
            ia: "Los comandos ADB (Android Debug Bridge) y Fastboot son herramientas de desarrollo avanzadas que permiten modificar el sistema desde una PC. Si no eres desarrollador, √∫salas con tutoriales muy espec√≠ficos.",
            keywords: ['adb', 'fastboot', 'comandos adb', 'android debug bridge'],
            riesgo: 'Medio. Uso incorrecto puede causar p√©rdida de datos o fallos de arranque.'
        },
        APPS_ADMINISTRADOR: {
            ia: "Si no puedes desinstalar una app, puede tener permisos de 'Administrador de dispositivos'. Ve a Ajustes > Seguridad > Aplicaciones de administraci√≥n del dispositivo y desact√≠vala primero.",
            keywords: ['desinstalar', 'app bloqueada', 'app del sistema', 'eliminar app'],
            riesgo: 'Medio. Desactivar apps de administrador puede comprometer la seguridad si la app es esencial.'
        },
        MODO_DESARROLLADOR: {
            ia: "Para activar el 'Modo de Desarrollador', ve a Ajustes > Acerca del tel√©fono > Informaci√≥n de software y toca 7 veces seguidas el 'N√∫mero de compilaci√≥n'. Esto desbloquea opciones avanzadas.",
            keywords: ['modo desarrollador', 'opciones desarrollador', 'numero compilacion'],
            riesgo: null
        },
    
        // --- FALLOS Y CONECTIVIDAD (400-499) ---
        WIFI_FALLO: {
            ia: "Si el Wi-Fi no conecta, intenta: 1. Reiniciar el router y el tel√©fono. 2. Restablecer ajustes de red (Ajustes > Restablecer ajustes de red). Esto es m√°s efectivo que solo reiniciar.",
            keywords: ['wifi no conecta', 'internet fallo', 'red no funciona', 'red intermitente', 'fallo wifi'],
            riesgo: 'Bajo. El restablecimiento de red borra contrase√±as de Wi-Fi y dispositivos Bluetooth.'
        },
        GOOGLE_PLAY_FALLO: {
            ia: "Si Google Play falla (cierra, no descarga), borra la cach√© y los datos de 'Google Play Store' y 'Servicios de Google Play' en Ajustes > Aplicaciones. Es la soluci√≥n m√°s efectiva.",
            keywords: ['google play fallo', 'play store', 'no descarga', 'error 403', 'app no instala'],
            riesgo: null
        },
        BLUETOOTH_FALLO: {
            ia: "Los fallos de Bluetooth suelen resolverse al Restablecer Ajustes de Red. Si eso no funciona, verifica si el otro dispositivo est√° en modo de emparejamiento o si la funci√≥n de 'Visibilidad' de tu m√≥vil est√° activada.",
            keywords: ['bluetooth', 'no conecta', 'audifonos', 'emparejamiento', 'fallo bluetooth'],
            riesgo: 'Bajo. Restablecer ajustes de red.'
        },
        PANTALLA_NEGRA: {
            ia: "Si tienes la pantalla negra, intenta un 'Reinicio Forzado': Mant√©n pulsado el bot√≥n de **Bajar Volumen + Encendido** por 10 segundos. Si el fallo persiste, es probable que sea hardware.",
            keywords: ['pantalla negra', 'no enciende', 'solo vibra', 'brick suave', 'bootloop'],
            riesgo: null
        },
        GPS_FALLO: {
            ia: "Si el GPS no es preciso o no fija ubicaci√≥n, verifica que el 'Modo de ubicaci√≥n' est√© en 'Alta precisi√≥n' y no solo en 'Ahorro de bater√≠a'. Puedes calibrar la br√∫jula en Google Maps.",
            keywords: ['gps no funciona', 'ubicacion inexacta', 'mapas no carga', 'calibrar brujula'],
            riesgo: null
        },
    
        // --- SERVICIOS Y COSTOS (500-599) ---
        PRECIOS: {
            ia: ["Nuestras tarifas principales son: Limpieza de software (C$50), Personalizaci√≥n completa (C$100), y el Paquete completo (Revisi√≥n + Limpieza + Personalizaci√≥n) por C$180.", "Si tienes problemas complejos, el Paquete Completo por C$180 es la mejor opci√≥n. Incluye diagn√≥stico, limpieza y optimizaci√≥n."],
            keywords: ['precio', 'cuanto cuesta', 'servicios', 'costo', 'tarifa', 'valor'],
            riesgo: null
        },
        DIRECCION: {
            ia: "Somos un servicio t√©cnico digital con asistencia remota. Para coordinar el servicio, debes contactarnos por nuestro WhatsApp oficial o visitar nuestro punto de servicio coordinado previamente.",
            keywords: ['ubicacion', 'direccion', 'donde estan', 'telefono', 'contacto', 'whatsapp'],
            riesgo: null
        },
        PAGOS: {
            ia: "Aceptamos pagos por transferencia bancaria (BAC, Banpro) y pagos m√≥viles (Tigo Money o Claro Pay). El pago se realiza una vez que el diagn√≥stico es aprobado por el cliente.",
            keywords: ['pagos', 'transferencia', 'como pagar', 'metodos de pago', 'tigo money', 'claro pay'],
            riesgo: null
        },
        
        // --- TEMAS ESPEC√çFICOS Y T√âCNICOS (600-999) ---
        MODO_FASTBOOT: {
            ia: "El modo Fastboot, es un protocolo para flashear im√°genes de arranque y particiones a bajo nivel. En Samsung, este modo es reemplazado en su mayor√≠a por el Modo Download (Odin).",
            keywords: ['fastboot mode', 'modo fastboot', 'flasheo de particiones', 'odin mode', 'modo download'],
            riesgo: 'ALTO. Requiere la herramienta Fastboot y el uso de comandos avanzados. Puede causar da√±o permanente.'
        },
        FRP_LOCK: {
            ia: "El FRP (Factory Reset Protection) es una medida de seguridad de Google que previene el uso de un tel√©fono robado al requerir la cuenta de Google anterior despu√©s de un reinicio de f√°brica. Para evitarlo, borra la cuenta de Google antes de hacer el reset.",
            keywords: ['frp', 'bloqueo frp', 'factory reset protection', 'cuenta google despues de reset'],
            riesgo: 'CR√çTICO. Si olvidas tu cuenta de Google, el tel√©fono queda inutilizable sin un servicio de desbloqueo FRP (costo adicional).'
        },
        CUSTOM_ROM: {
            ia: "Una ROM personalizada (Custom ROM) es una versi√≥n modificada de Android (ej. LineageOS). Su instalaci√≥n requiere Root y Bootloader desbloqueado. **ADVERTENCIA: Anula la garant√≠a.**",
            keywords: ['rom personalizada', 'lineageos', 'cyanogen', 'flash', 'odin', 'twrp'],
            riesgo: 'CR√çTICO. La anulaci√≥n de la garant√≠a y el riesgo de brick son muy altos.'
        },
        OVERCLOCKING_RIESGO: {
            ia: "Hacer Overclocking (aumentar la velocidad del CPU) puede mejorar el rendimiento, pero genera mucho m√°s calor, reduce dr√°sticamente la vida √∫til del hardware y puede fre√≠r el procesador.",
            keywords: ['overclock', 'aumentar cpu', 'potenciar', 'aumentar velocidad'],
            riesgo: 'CR√çTICO. Riesgo de sobrecalentamiento y da√±o f√≠sico al procesador y bater√≠a.'
        },
        MAGISK_RIESGO: {
            ia: "Magisk es una herramienta de Root 'sin sistema' que busca esconder el estado de Root. Es muy popular pero requiere desbloquear el Bootloader. Su uso es avanzado y de riesgo.",
            keywords: ['magisk', 'root sin sistema', 'ocultar root', 'root checker'],
            riesgo: 'ALTO. Proceso que requiere conocimientos t√©cnicos avanzados.'
        },
        
        // --- 900+: M√ÅS FALLOS ESPEC√çFICOS (Plantillas de expansi√≥n para la capacidad de 1000) ---
        FALLO_AURICULARES: {
            ia: "Si los auriculares no funcionan, limpia el puerto con aire comprimido (sin objetos met√°licos), ya que la suciedad puede causar fallos de conexi√≥n. Tambi√©n intenta reiniciar el tel√©fono.",
            keywords: ['auriculares no funcionan', 'puerto da√±ado', 'jack 3.5', 'tipo c audio'],
            riesgo: null
        },
        APP_SEGUNDO_PLANO: {
            ia: "Para evitar que una aplicaci√≥n se cierre en segundo plano (ej. WhatsApp o juegos), ve a Ajustes > Aplicaciones, selecciona la app y desactiva 'Optimizaci√≥n de bater√≠a' o activa 'Permitir actividad en segundo plano'.",
            keywords: ['cierra app', 'segundo plano', 'notificaciones no llegan', 'app se detiene'],
            riesgo: null
        },
        FALLO_CAMARA: {
            ia: "Si la c√°mara no funciona o se cierra, borra la cach√© y los datos de la aplicaci√≥n 'C√°mara'. Si eso no soluciona, intenta desinstalar y reinstalar cualquier app de c√°mara de terceros que uses.",
            keywords: ['camara no funciona', 'camara se cierra', 'flash no enciende', 'error de camara'],
            riesgo: null
        },
        // --- NUEVAS ENTRADAS PARA DEMOSTRAR EL 'AMPLIO CONOCIMIENTO' ---
        FALLO_SENSOR_HUELLA: {
            ia: "Si el sensor de huella falla, borra y registra tu huella de nuevo. Si persiste, comprueba que el protector de pantalla no interfiera. Si el fallo es espor√°dico, reinicia el sistema.",
            keywords: ['huella no funciona', 'sensor huella', 'lector de huellas'],
            riesgo: null
        },
        PANTALLA_QUEMADA: {
            ia: "La 'Pantalla Quemada' (Burn-in/Ghosting) es com√∫n en paneles AMOLED por im√°genes est√°ticas prolongadas. Se puede mitigar con apps de 'filtro verde' o reemplazando la pantalla.",
            keywords: ['pantalla quemada', 'ghosting', 'burn in', 'amoled'],
            riesgo: 'Medio. Es un fallo de hardware que se puede empeorar al forzar el brillo.'
        },
        MODO_SEGURO: {
            ia: "El Modo Seguro deshabilita todas las apps de terceros al arrancar, √∫til para diagnosticar si un fallo es causado por una app descargada. Se activa manteniendo presionado 'Apagar' y luego tocando 'Modo Seguro'.",
            keywords: ['modo seguro', 'safe mode', 'fallo app de terceros'],
            riesgo: null
        },
        VPN_CONFIGURACION: {
            ia: "Una VPN (Red Privada Virtual) encripta tu conexi√≥n. Para configurarla, ve a Ajustes > Conexiones > M√°s ajustes de conexi√≥n > VPN. Necesitar√°s los datos de configuraci√≥n de tu proveedor de VPN.",
            keywords: ['vpn', 'red privada', 'configurar vpn', 'conexion segura'],
            riesgo: null
        }
    };
    
    // ------------------------------------------------------------------
    // 2. L√ìGICA DEL CHAT Y B√öSQUEDA DE CONOCIMIENTO
    // ------------------------------------------------------------------

    const chatWindow = document.getElementById('chat-window');
    const userInput = document.getElementById('user-input');

    /**
     * Busca la mejor respuesta en la base de conocimiento usando un sistema de puntuaci√≥n.
     * @param {string} query Consulta del usuario.
     * @returns {Object} La respuesta con la IA y el nivel de riesgo.
     */
    function getBestResponse(query) {
        const normalizedQuery = query.toLowerCase();
        const queryWords = normalizedQuery.split(/\s+/).filter(word => word.length > 2);
        let bestMatch = iaKnowledge.DEFAULT;
        let maxScore = 0;

        // 1. Prioridad a las respuestas por defecto y esenciales (Saludo, Gracias)
        if (queryWords.some(word => iaKnowledge.SALUDO.keywords.includes(word))) {
            return {
                ia: iaKnowledge.SALUDO.ia[Math.floor(Math.random() * iaKnowledge.SALUDO.ia.length)],
                riesgo: iaKnowledge.SALUDO.riesgo
            };
        }
        if (queryWords.some(word => iaKnowledge.GRACIAS.keywords.includes(word))) {
            return {
                ia: iaKnowledge.GRACIAS.ia[Math.floor(Math.random() * iaKnowledge.GRACIAS.ia.length)],
                riesgo: iaKnowledge.GRACIAS.riesgo
            };
        }
        
        // 2. B√∫squeda por coincidencia de palabras clave
        for (const key in iaKnowledge) {
            if (key === 'DEFAULT' || key === 'SALUDO' || key === 'GRACIAS') continue;
            
            let currentScore = 0;
            const entry = iaKnowledge[key];
            
            entry.keywords.forEach(keyword => {
                if (normalizedQuery.includes(keyword)) {
                    currentScore += 1;
                }
            });
            
            if (currentScore > maxScore) {
                maxScore = currentScore;
                bestMatch = entry;
            }
        }
        
        // Si no hay score, devuelve la respuesta por defecto
        if (maxScore === 0) {
            return iaKnowledge.DEFAULT;
        }

        // Si la respuesta es un array (respuestas m√∫ltiples), elige una al azar
        const responseText = Array.isArray(bestMatch.ia) ? 
                             bestMatch.ia[Math.floor(Math.random() * bestMatch.ia.length)] : 
                             bestMatch.ia;
                             
        return {
            ia: responseText,
            riesgo: bestMatch.riesgo
        };
    }

    /**
     * A√±ade un mensaje a la ventana del chat.
     * @param {string} text Contenido del mensaje.
     * @param {string} sender 'user' o 'ia'.
     * @param {string|null} risk Nivel de riesgo ('ALTO', 'CR√çTICO', 'Medio', 'Bajo', null).
     */
    function addMessage(text, sender, risk = null) {
        const row = document.createElement('div');
        row.className = `message-row message-${sender}`;

        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        bubble.innerHTML = text; // Usamos innerHTML para permitir formato (ej. **negritas**)

        row.appendChild(bubble);

        if (sender === 'ia' && risk) {
            const riskContainer = document.createElement('div');
            riskContainer.className = `risk-indicator risk-indicator-${risk.toLowerCase().replace(/\s/g, '-')}`;
            riskContainer.textContent = `üö® RIESGO: ${risk.toUpperCase()}`;
            
            // Colocar el indicador de riesgo debajo de la burbuja del IA
            const riskRow = document.createElement('div');
            riskRow.className = `message-row message-ia`;
            riskRow.style.marginTop = '-10px';
            riskRow.appendChild(riskContainer);
            chatWindow.appendChild(riskRow);
        }

        chatWindow.appendChild(row);
        chatWindow.scrollTop = chatWindow.scrollHeight; // Auto-scroll
    }

    /**
     * Funci√≥n principal para enviar el mensaje del usuario y recibir la respuesta de la IA.
     */
    function sendMessage() {
        const query = userInput.value.trim();
        if (query === '') return;

        // 1. Mostrar mensaje del usuario
        addMessage(query, 'user');
        userInput.value = ''; // Limpiar input

        // 2. Procesar y obtener respuesta de la IA
        setTimeout(() => {
            const responseData = getBestResponse(query);
            
            // 3. Mostrar respuesta de la IA
            addMessage(responseData.ia, 'ia', responseData.riesgo);

        }, 800); // Peque√±o retraso para simular "pensamiento"
    }

    // Permitir enviar con la tecla Enter
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }
    
    // Mensaje de bienvenida inicial
    document.addEventListener('DOMContentLoaded', () => {
        addMessage(iaKnowledge.SALUDO.ia[0], 'ia');
    });
    </script>
</body>
</html>

